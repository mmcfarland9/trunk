/* === Shell === */
.app-shell { width: min(1400px, 100%); display: flex; flex-direction: column; gap: 0.25rem; height: 100%; animation: fade-in 600ms ease; }
.app-header { display: flex; justify-content: flex-start; align-items: center; gap: var(--space-3); padding-bottom: var(--space-2); margin-bottom: 1.5rem; position: relative; z-index: 20; }
.header-logo { position: absolute; top: 2rem; right: -1.75rem; width: 144px; height: 144px; object-fit: contain; pointer-events: none; }

/* === Resource Meters (unified) === */
.resource-meter {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-1) var(--space-2);
  font-family: var(--font-ascii);
  border: 1px solid var(--meter-color, var(--border));
  background: var(--meter-bg, transparent);
}

.resource-meter-label {
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--meter-color, var(--ink-faint));
  white-space: nowrap;
}

.resource-meter-track {
  width: 80px;
  height: 6px;
  background: var(--border-subtle);
  border: 1px solid var(--border-subtle);
  overflow: hidden;
}

.resource-meter-track.resource-circles {
  width: auto;
  height: auto;
  overflow: visible;
  background: transparent;
  border: none;
}

.resource-meter-fill {
  height: 100%;
  background: var(--meter-color, var(--ink));
  opacity: 0.7;
  transition: width 400ms ease;
}

.resource-meter-value {
  font-size: var(--text-xs);
  color: var(--meter-color, var(--ink-faint));
  min-width: 14ch;
  text-align: right;
  white-space: nowrap;
}

/* Meter color variants */
.soil-meter {
  --meter-color: var(--wood);
  --meter-bg: rgba(107, 68, 35, 0.04);
}

.water-meter {
  --meter-color: var(--water);
  --meter-bg: rgba(70, 130, 180, 0.04);
}

.sun-meter {
  --meter-color: var(--sun);
  --meter-bg: rgba(212, 160, 0, 0.04);
}

/* Circle-based meters (water, sun) */
.resource-circles {
  display: flex;
  align-items: center;
  gap: 4px;
}

.resource-circle {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  border: 1px solid var(--border);
  background: transparent;
  transition: background 200ms ease;
}

.resource-circle.is-filled {
  background: var(--meter-color, var(--ink));
}

/* Celebration pulse after resource actions */
@keyframes meter-celebrate {
  0% { transform: scale(1); }
  40% { transform: scale(1.06); }
  100% { transform: scale(1); }
}

.resource-meter.is-celebrating {
  animation: meter-celebrate 500ms ease-out;
}

/* Profile badge - matches resource meter style */
.profile-badge {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-1) var(--space-2);
  font-family: var(--font-ascii);
  border: 1px solid var(--ink-faint);
  background: transparent;
  cursor: pointer;
  transition: border-color 150ms ease, background 150ms ease;
}

.profile-badge:hover {
  border-color: var(--ink);
  background: rgba(0, 0, 0, 0.02);
}

.profile-badge.hidden { display: none; }

.profile-icon {
  display: flex;
  align-items: center;
  color: var(--ink);
}

.profile-email {
  font-size: var(--text-xs);
  color: var(--ink-faint);
  max-width: 260px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Profile group - wraps badge + sync so sync stretches to badge height */
.profile-group {
  display: flex;
  align-items: stretch;
  gap: var(--space-2);
}

/* Sync button - square icon matching profile badge height */
.sync-button {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  padding: 0;
  border: 1px solid var(--ink-faint);
  background: transparent;
  color: var(--ink-faint);
  cursor: pointer;
  transition: border-color 150ms ease, color 150ms ease;
}

.sync-button:hover {
  border-color: var(--ink);
  color: var(--ink);
}

.sync-button.hidden { display: none; }

.sync-button.is-syncing .sync-icon {
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Sync status text indicator */
.sync-status-line {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: var(--font-ascii);
  font-size: var(--text-xs);
}

.sync-timestamp {
  color: #e6b800;
  font-variant-numeric: tabular-nums;
}

.sync-state {
  white-space: nowrap;
}

.sync-state[data-status="synced"] { color: #22a522; }
.sync-state[data-status="syncing"],
.sync-state[data-status="loading"] { color: #e6b800; }
.sync-state[data-status="pendingUpload"] { color: #d4880a; }
.sync-state[data-status="offline"] { color: #d9534f; }

.app-actions { display: flex; flex-wrap: wrap; gap: var(--space-2); align-items: center; }

.meter-group { display: flex; gap: var(--space-2); margin-left: auto; align-items: center; }
.app-body { display: grid; grid-template-columns: minmax(0, 1fr) 360px; gap: 1.5rem; align-items: start; flex: 1; min-height: 0; }
.map-panel { display: flex; flex-direction: column; gap: 1rem; align-items: center; margin-top: 3rem; position: relative; flex: 1; min-height: 0; }

/* === Canvas === */
.canvas { position: relative; --canvas-max-height: max(320px, calc(100vh - 210px)); --base-scale: 1.375; --camera-x: 0; --camera-y: 0; width: min(100%, 1100px, calc(var(--canvas-max-height) * 14 / 9)); aspect-ratio: 14 / 9; overflow: visible; transform: translate3d(var(--camera-x, 0px), var(--camera-y, 0px), 0) scale(calc(var(--base-scale) * var(--camera-scale, 1))); transform-origin: var(--zoom-origin-x, 50%) var(--zoom-origin-y, 50%); transition: transform 480ms ease-in-out; will-change: transform; }
.canvas.is-zoomed { --camera-scale: 1.02; }
.canvas.is-twig-zoomed { --camera-scale: 1.12; overflow: hidden; }
.canvas.is-twig-zoomed .branch-group,
.canvas.is-twig-zoomed .node.trunk {
  opacity: 0;
  pointer-events: none;
  transition: opacity 350ms ease-out;
}
.canvas.is-twig-zoomed + .guide-layer {
  opacity: 0;
  transition: opacity 250ms ease-out;
}
.canvas.is-previewing { cursor: pointer; }
.guide-layer { position: absolute; pointer-events: none; z-index: 10; transition: opacity 200ms ease; }
.branch-group { position: absolute; width: 0; height: 0; z-index: 1; transition: left 280ms ease, top 280ms ease, opacity 350ms ease; will-change: left, top, opacity; }
.branch-group.is-active { z-index: 3; }
.branch-group.is-preview { z-index: 2; }
.canvas.is-zooming .branch-group { transition-duration: 480ms; transition-timing-function: ease-in-out; }
.canvas.is-previewing .branch-group.is-preview .twig { opacity: 0.7; transition: opacity 500ms cubic-bezier(0.4, 0, 0.2, 1); }

/* === Responsive === */
@media (max-width: 960px) {
  body { padding: 1rem; }
  .app-header { flex-direction: column; align-items: flex-start; }
  .app-actions { justify-content: flex-start; }
  .meter-group { margin-left: 0; }
  .header-logo { align-self: flex-end; }
  .app-body { grid-template-columns: 1fr; gap: 2rem; }
  .map-panel { margin-top: 6px; }
  .side-panel { order: 2; }
}
@media (max-width: 720px) {
  body { padding: 0.85rem 0.75rem; }
  .app-shell { gap: 1.1rem; }
  .map-panel { margin-top: 4px; }
  .header-logo { width: 64px; height: 64px; }
}
@media (max-width: 520px) {
  .action-button { flex: 1; min-width: calc(50% - 0.25rem); }
}

/* Touch device improvements - min 44px touch targets */
@media (pointer: coarse) {
  .action-btn,
  .btn,
  .action-button {
    min-height: 44px;
    padding: 0.75rem 1rem;
  }
  .panel-button,
  .sprouts-toggle,
  .back-to-trunk,
  .back-to-branch {
    min-height: 44px;
  }
}
