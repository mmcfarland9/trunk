/* === Shell === */
.app-shell { width: min(1400px, 100%); display: flex; flex-direction: column; gap: 0.25rem; height: 100%; animation: fade-in 600ms ease; }
.app-header { display: flex; justify-content: flex-start; align-items: center; gap: var(--space-3); padding-bottom: var(--space-2); margin-bottom: 1.5rem; position: relative; z-index: 20; }
.header-logo { position: absolute; top: 2rem; right: -1.75rem; width: 144px; height: 144px; object-fit: contain; pointer-events: none; }

/* === Resource Meters (unified) === */
.resource-meter {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-1) var(--space-2);
  font-family: var(--font-ascii);
  border: 1px solid var(--meter-color, var(--border));
  background: var(--meter-bg, transparent);
}

.resource-meter-label {
  font-size: var(--text-xs);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--meter-color, var(--ink-faint));
  white-space: nowrap;
}

.resource-meter-track {
  width: 80px;
  height: 6px;
  background: var(--border-subtle);
  border: 1px solid var(--border-subtle);
  overflow: hidden;
}

.resource-meter-track.resource-circles {
  width: auto;
  height: auto;
  overflow: visible;
  background: transparent;
  border: none;
}

.resource-meter-fill {
  height: 100%;
  background: var(--meter-color, var(--ink));
  opacity: 0.7;
  transition: width 400ms ease;
}

.resource-meter-value {
  font-size: var(--text-xs);
  color: var(--meter-color, var(--ink-faint));
  min-width: 3ch;
  text-align: right;
}

/* Meter color variants */
.soil-meter {
  --meter-color: var(--wood);
  --meter-bg: rgba(107, 68, 35, 0.04);
}

.water-meter {
  --meter-color: var(--water);
  --meter-bg: rgba(70, 130, 180, 0.04);
}

.sun-meter {
  --meter-color: var(--sun);
  --meter-bg: rgba(212, 160, 0, 0.04);
}

/* Circle-based meters (water, sun) */
.resource-circles {
  display: flex;
  align-items: center;
  gap: 4px;
}

.resource-circle {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  border: 1px solid var(--border);
  background: transparent;
  transition: background 200ms ease;
}

.resource-circle.is-filled {
  background: var(--meter-color, var(--ink));
}

/* === Future Ideas Folder === */
.future-ideas-folder {
  position: fixed;
  bottom: 4rem;
  left: 1rem;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 50;
}
.future-ideas-folder.hidden { display: none; }

.future-ideas-toggle {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  padding: 0.35rem 0.5rem;
  background: rgba(180, 60, 60, 0.06);
  border: 1px dashed #b43c3c;
  font-family: var(--font-ascii);
  font-size: calc(var(--char) * 0.5);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #b43c3c;
  white-space: nowrap;
  user-select: none;
  cursor: pointer;
  transition: background 150ms ease;
}

.future-ideas-toggle:hover {
  background: rgba(180, 60, 60, 0.12);
}

.future-ideas-arrow {
  font-size: 0.6rem;
  transition: transform 200ms ease;
}

.future-ideas-folder.is-collapsed .future-ideas-arrow {
  transform: rotate(-90deg);
}

.future-ideas-content {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
  padding: 0.35rem 0.5rem;
  background: rgba(180, 60, 60, 0.04);
  border: 1px dashed #b43c3c;
  border-top: none;
  overflow: hidden;
  max-height: 200px;
  transition: max-height 200ms ease, padding 200ms ease, opacity 150ms ease;
}

.future-ideas-folder.is-collapsed .future-ideas-content {
  max-height: 0;
  padding-top: 0;
  padding-bottom: 0;
  opacity: 0;
  pointer-events: none;
}

.future-idea-item {
  color: #b43c3c !important;
  opacity: 0.6;
  cursor: not-allowed !important;
  font-size: 0.7rem !important;
  padding: 0.25rem 0.4rem !important;
  text-decoration: line-through;
  text-decoration-color: rgba(180, 60, 60, 0.4);
  text-align: left;
}

.future-idea-item:hover {
  opacity: 0.8;
  color: #b43c3c !important;
}

.future-idea-item:disabled {
  pointer-events: auto;
}
.app-actions { display: flex; flex-wrap: wrap; gap: var(--space-2); align-items: center; }

.meter-group { display: flex; gap: var(--space-2); margin-left: auto; align-items: center; }
.app-body { display: grid; grid-template-columns: minmax(0, 1fr) 360px; gap: 1.5rem; align-items: start; flex: 1; min-height: 0; }
.map-panel { display: flex; flex-direction: column; gap: 1rem; align-items: center; margin-top: 3rem; position: relative; flex: 1; min-height: 0; }
.debug-toggle { position: fixed; bottom: 1rem; right: 1rem; display: none; align-items: center; gap: var(--space-2); font-size: var(--text-sm); color: var(--ink-faint); cursor: pointer; user-select: none; z-index: 100; }
.debug-toggle input { cursor: pointer; }
.debug-panel { position: fixed; bottom: 1rem; left: 1rem; display: flex; flex-direction: column; gap: var(--space-2); z-index: 100; }
.debug-btn { display: flex; justify-content: center; align-items: center; background: transparent; border: 1px solid #c44; color: #c44; padding: var(--space-1) var(--space-2); font-family: var(--font-ascii); font-size: var(--text-sm); cursor: pointer; transition: border-color 150ms ease, color 150ms ease, background 150ms ease; }
.debug-btn:hover { border-color: #a33; color: #a33; background: rgba(204, 68, 68, 0.05); }
.debug-lock-btn { min-width: 7ch; border-color: var(--border); color: var(--ink-faint); }
.debug-lock-btn:hover { border-color: var(--ink); color: var(--ink); background: transparent; }
.debug-mode-toggle { display: flex; align-items: center; gap: var(--space-2); font-size: var(--text-sm); color: var(--ink-faint); cursor: pointer; user-select: none; }
.debug-mode-toggle input { cursor: pointer; }
.debug-controls { display: flex; flex-direction: column; gap: var(--space-2); margin-top: var(--space-2); }
.debug-controls.hidden { display: none; }

/* === Canvas === */
.canvas { position: relative; --canvas-max-height: max(320px, calc(100vh - 210px)); --base-scale: 1.25; width: min(100%, 1100px, calc(var(--canvas-max-height) * 14 / 9)); aspect-ratio: 14 / 9; overflow: visible; transform: translate3d(var(--camera-x, 0px), var(--camera-y, 0px), 0) scale(calc(var(--base-scale) * var(--camera-scale, 1))); transform-origin: var(--zoom-origin-x, 50%) var(--zoom-origin-y, 50%); transition: transform 480ms ease-in-out; will-change: transform; }
.canvas.is-zoomed { --camera-scale: 1.02; }
.canvas.is-twig-zoomed { --camera-scale: 1.12; overflow: hidden; }
.canvas.is-twig-zoomed .branch-group,
.canvas.is-twig-zoomed .node.trunk { opacity: 0; pointer-events: none; }
.canvas.is-twig-zoomed + .guide-layer { opacity: 0; }
.canvas.is-previewing { cursor: pointer; }
.guide-layer { position: absolute; pointer-events: none; z-index: 10; transition: opacity 200ms ease; }
.ascii-line { position: absolute; transform: translate(-50%, -50%); font-family: var(--font-ascii); font-size: var(--char); line-height: 1; color: var(--ink-faint); pointer-events: none; user-select: none; }
.ascii-line.trunk { color: var(--wood); opacity: 0.6; }
.ascii-line.branch { color: var(--ink-faint); opacity: 0.5; }
.ascii-line.twig { color: var(--twig); opacity: 0.4; }
.branch-group { position: absolute; width: 0; height: 0; z-index: 1; transition: left 280ms ease, top 280ms ease, opacity 200ms ease; will-change: left, top, opacity; }
.branch-group.is-active { z-index: 3; }
.branch-group.is-preview { z-index: 2; }
.canvas.is-zooming .branch-group { transition-duration: 480ms; transition-timing-function: ease-in-out; }
.canvas.is-previewing .branch-group.is-preview .twig { opacity: 0.7; transition: opacity 500ms cubic-bezier(0.4, 0, 0.2, 1); }

/* === Responsive === */
@media (max-width: 960px) {
  body { padding: 1rem; }
  .app-header { flex-direction: column; align-items: flex-start; }
  .app-actions { justify-content: flex-start; }
  .meter-group { margin-left: 0; }
  .header-logo { align-self: flex-end; }
  .app-body { grid-template-columns: 1fr; gap: 2rem; }
  .map-panel { margin-top: 6px; }
  .side-panel { order: 2; }
}
@media (max-width: 720px) {
  body { padding: 0.85rem 0.75rem; }
  .app-shell { gap: 1.1rem; }
  .map-panel { margin-top: 4px; }
  .header-logo { width: 64px; height: 64px; }
}
@media (max-width: 520px) {
  .action-button { flex: 1; min-width: calc(50% - 0.25rem); }
}
