/* === Shell === */
.app-shell { width: min(1400px, 100%); display: flex; flex-direction: column; gap: 0.25rem; height: 100%; animation: fade-in 600ms ease; }
.app-header { display: flex; justify-content: flex-start; align-items: flex-start; gap: 1rem; }
.header-logo { width: 108px; height: 108px; object-fit: contain; margin-left: auto; }
.app-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: flex-end; align-items: center; }
.app-body { display: grid; grid-template-columns: minmax(0, 1fr) 280px; gap: 2rem; align-items: start; flex: 1; min-height: 0; }
.map-panel { display: flex; flex-direction: column; gap: 1rem; align-items: center; margin-top: 8px; position: relative; flex: 1; min-height: 0; }
.debug-toggle { position: fixed; bottom: 1rem; right: 1rem; display: none; align-items: center; gap: 0.5rem; font-size: 0.75rem; color: var(--ink-faint); cursor: pointer; user-select: none; z-index: 100; }
.debug-toggle input { cursor: pointer; }
.debug-panel { position: fixed; bottom: 1rem; left: 1rem; display: flex; flex-direction: column; gap: 0.5rem; z-index: 100; }
.debug-btn { display: flex; justify-content: center; align-items: center; background: transparent; border: 1px solid #c44; color: #c44; padding: 0.35rem 0.6rem; font-family: var(--font-ascii); font-size: 0.75rem; cursor: pointer; transition: border-color 150ms ease, color 150ms ease, background 150ms ease; }
.debug-btn:hover { border-color: #a33; color: #a33; background: rgba(204, 68, 68, 0.05); }
.debug-lock-btn { min-width: 7ch; border-color: var(--border); color: var(--ink-faint); }
.debug-lock-btn:hover { border-color: var(--ink); color: var(--ink); background: transparent; }

/* === Canvas === */
.canvas { position: relative; --canvas-max-height: max(320px, calc(100vh - 210px)); --base-scale: 1.25; width: min(100%, 1100px, calc(var(--canvas-max-height) * 14 / 9)); aspect-ratio: 14 / 9; overflow: visible; transform: translate3d(var(--camera-x, 0px), var(--camera-y, 0px), 0) scale(calc(var(--base-scale) * var(--camera-scale, 1))); transform-origin: center; transition: transform 480ms ease-in-out; will-change: transform; }
.canvas.is-zoomed { --camera-scale: 1.02; }
.canvas.is-twig-zoomed { --base-scale: 1; --camera-scale: 1; transform: none; overflow: hidden; }
.canvas.is-twig-zoomed .branch-group,
.canvas.is-twig-zoomed .node.trunk { opacity: 0; pointer-events: none; }
.canvas.is-twig-zoomed + .guide-layer { opacity: 0; }
.canvas.is-previewing { cursor: pointer; }
.guide-layer { position: absolute; pointer-events: none; z-index: 10; transition: opacity 200ms ease; }
.ascii-line { position: absolute; transform: translate(-50%, -50%); font-family: var(--font-ascii); font-size: var(--char); line-height: 1; color: var(--ink-faint); pointer-events: none; user-select: none; }
.ascii-line.trunk { color: var(--wood); opacity: 0.6; }
.ascii-line.branch { color: var(--ink-faint); opacity: 0.5; }
.ascii-line.twig { color: var(--twig); opacity: 0.4; }
.branch-group { position: absolute; width: 0; height: 0; z-index: 1; transition: left 280ms ease, top 280ms ease, opacity 200ms ease; will-change: left, top, opacity; }
.branch-group.is-active { z-index: 3; }
.branch-group.is-preview { z-index: 2; }
.canvas.is-zooming .branch-group { transition-duration: 480ms; transition-timing-function: ease-in-out; }
.canvas.is-previewing .branch-group.is-preview .twig { opacity: 0.7; transition: opacity 500ms cubic-bezier(0.4, 0, 0.2, 1); }

/* === Responsive === */
@media (max-width: 960px) {
  body { padding: 1rem; }
  .app-header { flex-direction: column; align-items: flex-start; }
  .app-actions { justify-content: flex-start; }
  .header-logo { align-self: flex-end; }
  .app-body { grid-template-columns: 1fr; gap: 2rem; }
  .map-panel { margin-top: 6px; }
  .side-panel { order: 2; }
}
@media (max-width: 720px) {
  body { padding: 0.85rem 0.75rem; }
  .app-shell { gap: 1.1rem; }
  .map-panel { margin-top: 4px; }
  .header-logo { width: 64px; height: 64px; }
}
@media (max-width: 520px) {
  .action-button { flex: 1; min-width: calc(50% - 0.25rem); }
}
